# SlackからLINEにメッセージを送るツール 📬

このツールは、Slackのチャンネルから情報を取得して、LINEに送信するシンプルなツールです。

## 📋 目次

1. [このツールは何をするの？](#このツールは何をするの)
2. [必要なもの](#必要なもの)
3. [準備するもの（APIキーなど）](#準備するものapiキーなど)
4. [インストール手順](#インストール手順)
5. [設定方法](#設定方法)
6. [使い方](#使い方)
7. [トラブルシューティング](#トラブルシューティング)

---

## このツールは何をするの？

このツールを使うと、以下のことができます：

1. **Slackのチャンネルからメッセージを自動で取得する**
   - 指定したチャンネルのメッセージを読み取ります
   - 過去24時間（設定可能）のメッセージを取得できます

2. **メッセージを要約する（オプション）**
   - たくさんのメッセージがある場合、重要な部分だけをまとめます
   - 全部送りたい場合は、要約なしでも送れます

3. **LINEに自動で送信する**
   - 取得したメッセージを、あなたのLINEに自動で送ります
   - 見逃しを防げます！

---

## 必要なもの

このツールを使うために、以下のものが必要です：

### 1. パソコン（Windows、Mac、Linux どれでもOK）
- Python（プログラミング言語）がインストールされていること
- インターネットに接続できること

### 2. Slackのアカウントとワークスペース
- Slackを使えること
- ボットを作成する権限があること

### 3. LINEのアカウント
- LINEを使えること
- LINE Developersアカウントを作成できること

---

## 準備するもの（APIキーなど）

このツールを使うには、3つの「鍵（キー）」が必要です。これらは、SlackやLINEが「このプログラムは安全ですよ」と認めるためのものです。

### 🔑 鍵1: Slack Bot Token（スラック ボット トークン）

**これは何？**
- Slackのボット（ロボット）がメッセージを読み取るための鍵です

**どうやって作る？**

1. **Slackのワークスペースにログインする**
   - ブラウザで https://api.slack.com/apps を開きます

2. **新しいアプリを作る**
   - 「Create New App」ボタンをクリック
   - 「From scratch」を選ぶ
   - アプリ名を入力（例：「メッセージ取得ボット」）
   - ワークスペースを選ぶ
   - 「Create App」をクリック

3. **ボットの権限を設定する**
   - 左側のメニューから「OAuth & Permissions」をクリック
   - 「Scopes」の「Bot Token Scopes」セクションで、以下の権限を追加：
     - `channels:history` - チャンネルのメッセージを読み取る（必須）
     - `channels:read` - 公開チャンネルの情報を読み取る（必須）
     - `groups:read` - プライベートチャンネルの情報を読み取る（プライベートチャンネルを使う場合のみ）
     - `users:read` - ユーザー情報を読み取る（推奨）
   - 下にスクロールして「Install to Workspace」をクリック
   - 確認画面で「許可する」をクリック
   - **重要：** チャンネル名からチャンネルIDを取得するには、`channels:read`（公開チャンネル）または`groups:read`（プライベートチャンネル）が必要です。これらのスコープがない場合は、チャンネルIDを直接指定してください。

4. **トークンをコピーする**
   - 「OAuth & Permissions」ページに戻る
   - 「Bot User OAuth Token」という部分を見つける
   - トークンは `xoxb-` で始まる長い文字列です
   - このトークンをコピーして、メモ帳などに保存しておきます

5. **ボットをチャンネルに追加する**
   
   **方法1: チャンネル情報から追加する（推奨）**
   1. Slackのワークスペースで、メッセージを取得したいチャンネル（例：`#all-test`）を開く
   2. チャンネル名の横にある「i」アイコン（情報アイコン）をクリック
      - または、チャンネル名をクリックして「チャンネルの詳細」を開く
   3. 左側のメニューまたはタブから「統合」または「Integrations」をクリック
   4. 「アプリを追加する」または「Add apps」ボタンをクリック
   5. 検索ボックスに、さっき作ったボットの名前を入力
   6. ボットを選んで「追加」または「Add」をクリック
   7. 確認画面で「追加」をクリック
   
   **方法2: チャンネルで直接メンションする**
   1. チャンネル（例：`#all-test`）を開く
   2. メッセージ入力欄に `/invite @ボット名` と入力
      - 例：`/invite @メッセージ取得ボット`
   3. Enterキーを押す
   4. ボットがチャンネルに追加されます
   
   **方法3: チャンネル設定から追加する**
   1. チャンネルを開く
   2. チャンネル名の横の「▼」をクリック
   3. 「設定」または「Settings」を選ぶ
   4. 「統合」または「Integrations」セクションを開く
   5. 「アプリを追加する」をクリック
   6. ボットを検索して追加
   
   **確認方法：**
   - チャンネルに追加されると、チャンネルに「○○がチャンネルに追加されました」というメッセージが表示されます
   - チャンネル情報の「統合」タブに、追加したボットが表示されていることを確認してください

**重要：** このトークンは秘密です！誰にも教えないでください。

---

### 🔑 鍵2: LINE Channel Access Token（ライン チャンネル アクセス トークン）

**これは何？**
- LINEにメッセージを送るための鍵です

**どうやって作る？**

1. **LINE Developersに登録する**
   - ブラウザで https://developers.line.biz/ を開きます
   - 「ログイン」をクリック
   - LINEアカウントでログインします

2. **プロバイダーを作る**
   - ログイン後、「プロバイダー」ページに行く
   - 「新規作成」をクリック
   - プロバイダー名を入力（例：「メッセージ通知」）
   - 「作成」をクリック

3. **チャネルを作る**
   - 作ったプロバイダーを選ぶ
   - 「Messaging API」を選ぶ
   - 「チャネルを作成」をクリック
   - チャネル名、説明、カテゴリーなどを入力
   - 利用規約に同意して「作成」をクリック

4. **トークンをコピーする**
   - チャネル設定ページで「Messaging API」タブを開く
   - 「Channel access token」セクションを見つける
   - 「発行」ボタンをクリック（まだ発行していない場合）
   - 表示されたトークンをコピーして、メモ帳などに保存しておきます
   - トークンは長い文字列で、`=` で終わることが多いです

**重要：** このトークンも秘密です！誰にも教えないでください。

---

### 🔑 鍵3: LINE User ID（ライン ユーザー ID）

**これは何？**
- メッセージを送る相手（あなた）を特定するためのIDです

**どうやって見つける？**

1. **QRコードを取得する**
   - LINE Developersのチャネル設定ページで「Messaging API」タブを開く
   - 「QRコード」セクションを見つける
   - QRコードを表示する

2. **友だち追加する**
   - スマートフォンのLINEアプリを開く
   - QRコードをスキャンして、ボットを友だち追加する

3. **Webhook URLを設定する（一時的）**
   - チャネル設定ページで「Messaging API」タブを開く
   - 「Webhook URL」セクションを見つける
   - 一時的に、以下のURLを設定：
     ```
     https://httpbin.org/post
     ```
   - 「検証」ボタンをクリックして、成功することを確認

4. **メッセージを送ってUser IDを取得**
   - スマートフォンで、さっき友だち追加したボットにメッセージを送る
   - 例：「テスト」と送る

5. **Webhookのログを確認する**
   - ブラウザで https://httpbin.org/anything を開く
   - または、チャネル設定ページの「Webhookの利用状況」を確認
   - 送ったメッセージの情報が表示される
   - その中に `"userId": "U..."` という部分がある
   - この `U` で始まる文字列がUser IDです
   - これをコピーして、メモ帳などに保存しておきます

**別の方法（もっと簡単）：**
- LINE Developersのチャネル設定ページで「Messaging API」タブを開く
- 「Webhook URL」の下に「Webhookの利用状況」というセクションがある
- そこに送信されたメッセージの情報が表示される
- JSONの中に `userId` という項目があるので、それをコピー

**重要：** User IDを取得したら、Webhook URLは削除するか、無効にしておきましょう。

---

## インストール手順

### ステップ1: Pythonがインストールされているか確認する

1. **コマンドプロンプト（Windows）またはターミナル（Mac/Linux）を開く**
   - Windows: 「Win + R」キーを押して「cmd」と入力してEnter
   - Mac: 「Spotlight検索」で「ターミナル」と検索

2. **Pythonのバージョンを確認する**
   - コマンドプロンプト（ターミナル）に以下を入力：
     ```bash
     python --version
     ```
   - または：
     ```bash
     python3 --version
     ```
   - バージョンが表示されればOK（例：Python 3.9.0）
   - 表示されない場合は、Pythonをインストールする必要があります
     - https://www.python.org/downloads/ からダウンロード

### ステップ2: 必要なパッケージをインストールする

1. **このツールのフォルダに移動する**
   - コマンドプロンプト（ターミナル）で、以下のコマンドを実行：
     ```bash
     cd "実践/Slack　Line"
     ```
   - フォルダ名にスペースがある場合は、引用符で囲む必要があります

2. **パッケージをインストールする**
   - 以下のコマンドを実行：
     ```bash
     pip install -r requirements.txt
     ```
   - または：
     ```bash
     pip3 install -r requirements.txt
     ```
   - 少し時間がかかりますが、完了するまで待ちます

3. **インストールが成功したか確認する**
   - エラーが出なければOKです
   - エラーが出た場合は、後述の「トラブルシューティング」を参照してください

---

## 設定方法

### ステップ1: 設定ファイルを編集する

1. **`config.py` ファイルを開く**
   - メモ帳やテキストエディタで開きます
   - 推奨：Visual Studio Code、メモ帳++、Sublime Textなど

2. **3つの鍵を貼り付ける**
   - さっきメモ帳に保存した3つの鍵を、それぞれの場所に貼り付けます：

   ```python
   # Slack Bot Token
   SLACK_BOT_TOKEN = "ここにSlack Bot Tokenを貼り付け"
   
   # LINE Channel Access Token
   LINE_CHANNEL_ACCESS_TOKEN = "ここにLINE Channel Access Tokenを貼り付け"
   
   # LINE User ID
   LINE_USER_ID = "ここにLINE User IDを貼り付け"
   ```

3. **ファイルを保存する**
   - 「Ctrl + S」（Windows）または「Cmd + S」（Mac）で保存

### ステップ2: 設定が正しいか確認する

1. **テスト実行する**
   - コマンドプロンプト（ターミナル）で、以下のコマンドを実行：
     ```bash
     python main.py --channel "#all-test" --dry-run
     ```
   - または：
     ```bash
     python3 main.py --channel "#general" --dry-run
     ```
   - `--dry-run` は、実際にLINEに送信せず、内容を表示するだけのオプションです

2. **エラーが出ないか確認する**
   - エラーが出た場合は、後述の「トラブルシューティング」を参照してください

---

## 使い方

### 基本的な使い方

1. **コマンドプロンプト（ターミナル）を開く**

2. **このツールのフォルダに移動する**
   ```bash
   cd "実践/Slack　Line"
   ```

3. **コマンドを実行する**
   ```bash
   python main.py --channel "#チャンネル名"
   ```
   - 例：`#general` チャンネルからメッセージを取得する場合：
     ```bash
     python main.py --channel "#general"
     ```

4. **LINEを確認する**
   - メッセージがLINEに届いているか確認します

### オプション（便利な機能）

#### 過去12時間のメッセージを取得する
```bash
python main.py --channel "#general" --hours 12
```

#### 最大50件のメッセージを取得する
```bash
python main.py --channel "#general" --limit 50
```

#### 要約せずに全てのメッセージを送る
```bash
python main.py --channel "#general" --no-summary
```

#### テスト実行（実際には送信しない）
```bash
python main.py --channel "#general" --dry-run
```

### 自動実行する方法（上級者向け）

毎日自動で実行したい場合は、以下の方法があります：

#### Windowsの場合（タスクスケジューラ）

1. 「タスクスケジューラ」を開く
2. 「基本タスクの作成」を選ぶ
3. 名前を入力（例：「Slack LINE通知」）
4. トリガーを設定（例：毎日 9:00）
5. 操作を「プログラムの開始」に設定
6. プログラム：`python` または `python3` のフルパス
7. 引数：`"実践/Slack　Line/main.py" --channel "#general"`
8. 開始場所：このツールのフォルダのパス

#### Mac/Linuxの場合（cron）

1. ターミナルで以下を実行：
   ```bash
   crontab -e
   ```

2. 以下の行を追加（毎日9時に実行する例）：
   ```bash
   0 9 * * * cd /path/to/実践/Slack\ Line && python3 main.py --channel "#general"
   ```
   - `/path/to/` の部分は、実際のフォルダのパスに置き換えてください

---

## トラブルシューティング

### エラー1: `SLACK_BOT_TOKEN が設定されていません`

**原因：** Slack Bot Tokenが正しく設定されていません

**解決方法：**
1. `config.py` ファイルを開く
2. `SLACK_BOT_TOKEN` の値を確認する
3. トークンが正しく貼り付けられているか確認する
4. トークンの前後に余計なスペースや改行がないか確認する

### エラー2: `チャンネル 'xxx' が見つかりません` または `not_in_channel`

**原因：** 指定したチャンネルが存在しないか、ボットがチャンネルに追加されていません

**解決方法：**

**ステップ1: ボットをチャンネルに追加する**

以下のいずれかの方法でボットをチャンネルに追加してください：

**方法A: チャンネル情報から追加（最も確実）**
1. Slackのワークスペースで、メッセージを取得したいチャンネル（例：`#all-test`）を開く
2. チャンネル名の横にある「i」アイコン（情報アイコン）をクリック
   - または、チャンネル名をクリックして「チャンネルの詳細」を開く
3. 左側のメニューまたはタブから「統合」または「Integrations」をクリック
4. 「アプリを追加する」または「Add apps」ボタンをクリック
5. 検索ボックスに、作成したボットの名前を入力して検索
6. ボットを選んで「追加」または「Add」をクリック
7. 確認画面で「追加」をクリック

**方法B: チャンネルで直接メンションする（簡単）**
1. チャンネル（例：`#all-test`）を開く
2. メッセージ入力欄に以下のコマンドを入力：
   ```
   /invite @ボット名
   ```
   - 例：`/invite @メッセージ取得ボット`
   - ボット名は、作成したアプリの名前です
3. Enterキーを押す
4. ボットがチャンネルに追加されます

**方法C: チャンネル設定から追加**
1. チャンネルを開く
2. チャンネル名の横の「▼」をクリック
3. 「設定」または「Settings」を選ぶ
4. 「統合」または「Integrations」セクションを開く
5. 「アプリを追加する」をクリック
6. ボットを検索して追加

**ステップ2: 追加を確認する**
- チャンネルに追加されると、チャンネルに「○○がチャンネルに追加されました」というメッセージが表示されます
- チャンネル情報の「統合」タブに、追加したボットが表示されていることを確認してください

**ステップ3: 再度実行する**
- ボットを追加した後、再度コマンドを実行してください：
  ```bash
  python main.py --channel "#all-test" --dry-run
  ```

**それでもエラーが出る場合：**
- チャンネル名が正しいか確認する（大文字小文字、スペースなど）
- チャンネルIDを使う方法も試してみる：
  1. チャンネルを開く
  2. ブラウザのURLを確認（例：`https://workspace.slack.com/archives/C1234567890`）
  3. URLの最後の部分（`C1234567890`）がチャンネルID
  4. コマンドで `--channel "C1234567890"` と指定する

### エラー2-1: `必要な権限（スコープ）が不足しています` または `missing_scope`

**原因：** Slack Bot Tokenに必要な権限（スコープ）が設定されていません

**解決方法：**

**方法1: 必要なスコープを追加する（推奨）**
1. https://api.slack.com/apps を開く
2. 作成したアプリを選択
3. 左側のメニューから「OAuth & Permissions」をクリック
4. 「Scopes」の「Bot Token Scopes」セクションで、以下のスコープを追加：
   - `channels:read` - 公開チャンネルの情報を読み取る
   - `groups:read` - プライベートチャンネルの情報を読み取る（プライベートチャンネルを使う場合）
5. 下にスクロールして「Install to Workspace」をクリック（既にインストール済みの場合は「Reinstall to Workspace」）
6. 確認画面で「許可する」をクリック

**方法2: チャンネルIDを直接使用する（簡単）**
- チャンネル名の代わりにチャンネルIDを直接指定する
- チャンネルIDの取得方法：
  1. Slackでチャンネルを開く
  2. ブラウザのURLを確認（例：`https://workspace.slack.com/archives/C1234567890`）
  3. URLの最後の部分（`C1234567890`）がチャンネルID
  4. コマンドで `--channel "C1234567890"` と指定する

### エラー3: `LINE_CHANNEL_ACCESS_TOKEN が設定されていません`

**原因：** LINE Channel Access Tokenが正しく設定されていません

**解決方法：**
1. `config.py` ファイルを開く
2. `LINE_CHANNEL_ACCESS_TOKEN` の値を確認する
3. トークンが正しく貼り付けられているか確認する
4. トークンの前後に余計なスペースや改行がないか確認する

### エラー4: `LINE_USER_ID が設定されていません`

**原因：** LINE User IDが正しく設定されていません

**解決方法：**
1. `config.py` ファイルを開く
2. `LINE_USER_ID` の値を確認する
3. User IDが正しく貼り付けられているか確認する
4. User IDは `U` で始まる文字列であることを確認する

### エラー5: `Channel Access Token が無効です`

**原因：** LINE Channel Access Tokenが間違っているか、期限切れです

**解決方法：**
1. LINE Developersのチャネル設定ページを開く
2. 「Messaging API」タブを開く
3. 「Channel access token」を確認する
4. 必要に応じて、新しいトークンを発行する
5. 新しいトークンを `config.py` に貼り付ける

### エラー6: `pip install` でエラーが出る

**原因：** インターネット接続の問題や、パッケージのインストール権限の問題

**解決方法：**
1. インターネット接続を確認する
2. 管理者権限でコマンドプロンプトを開く（Windowsの場合）
3. 以下のコマンドを試す：
   ```bash
   pip install --user -r requirements.txt
   ```
4. それでもダメな場合は、Pythonのバージョンを確認する（3.7以上が必要）

### エラー7: `python` コマンドが見つからない

**原因：** Pythonがインストールされていないか、パスが通っていません

**解決方法：**
1. Pythonをインストールする
   - https://www.python.org/downloads/ からダウンロード
   - インストール時に「Add Python to PATH」にチェックを入れる
2. `python3` コマンドを試す（Mac/Linuxの場合）
3. Pythonのフルパスを指定する
   - Windowsの場合：`C:\Python39\python.exe` など
   - Mac/Linuxの場合：`/usr/bin/python3` など

---

## ファイルの説明

このツールは、以下のファイルで構成されています：

- **`main.py`** - メインプログラム。これを実行すると、Slackからメッセージを取得してLINEに送信します
- **`slack_client.py`** - Slackからメッセージを取得する機能
- **`line_client.py`** - LINEにメッセージを送信する機能
- **`summarizer.py`** - メッセージを要約する機能
- **`config.py`** - 設定ファイル（APIキーなどを設定）
- **`config_example.py`** - 設定ファイルのサンプル
- **`requirements.txt`** - 必要なパッケージのリスト
- **`README.md`** - このファイル（説明書）

---

## よくある質問（FAQ）

### Q1: メッセージがLINEに届きません

**A:** 以下を確認してください：
1. `config.py` の設定が正しいか
2. LINE User IDが正しいか（ボットを友だち追加しているか）
3. エラーメッセージが出ていないか
4. `--dry-run` オプションで内容を確認してみる

### Q2: 要約機能はどうやって動くの？

**A:** メッセージが3件以下の場合は、そのまま送信します。4件以上の場合は、最初と最後の数件を抜き出して、全体の件数と参加者数を表示します。

### Q3: 複数のチャンネルから取得できますか？

**A:** 現在のバージョンでは、1回の実行で1つのチャンネルからしか取得できません。複数のチャンネルから取得したい場合は、コマンドを複数回実行してください。

### Q4: メッセージが長すぎて送れません

**A:** このツールは自動的に長いメッセージを分割して送信します。2000文字を超える場合は、複数のメッセージに分けて送信されます。

### Q5: セキュリティは大丈夫？

**A:** `config.py` ファイルには秘密の情報（APIキー）が含まれています。このファイルをGitHubなどに公開しないでください。`.gitignore` ファイルに `config.py` を追加することをお勧めします。

---

## まとめ

このツールを使うと、Slackの重要なメッセージを見逃すことなく、LINEで受け取ることができます。

**主な手順：**
1. ✅ Slack Bot Tokenを取得
2. ✅ LINE Channel Access Tokenを取得
3. ✅ LINE User IDを取得
4. ✅ パッケージをインストール
5. ✅ `config.py` に設定を記入
6. ✅ `python main.py --channel "#チャンネル名"` で実行

何か問題があったら、このREADMEの「トラブルシューティング」セクションを確認してください。

それでは、便利に使ってください！🎉

